<!--
  This file is part of the "FnordMetric" project
    Copyright (c) 2014 Laura Schlimmer
    Copyright (c) 2014 Paul Asmuth, Google Inc.

  FnordMetric is free software: you can redistribute it and/or modify it under
  the terms of the GNU General Public License v3.0. You should have received a
  copy of the GNU General Public License along with this program. If not, see
  <http://www.gnu.org/licenses/>.
-->
<style type="text/css">
  fn-loader {
    display: none;
    height: 100%;
    width: 100%;
  }

  fn-loader[data-resolved] {
    display: block;
  }
</style>

<template id="fn-loader-base-tpl">
  <style type="text/css">
    .loader {
      height: 100%;
      width: 100%;
      background: #efefef;
      display: table;
    }

    .loader[data-transparent] {
      background: transparent;
    }
  </style>

  <div class="loader">
  </div>
</template>

<template id="fn-loader-loader1-tpl">
  <style type="text/css">
    .dotloader-container {
      display: block;
      width: 500px;
      display: table-cell;
      vertical-align: middle;
    }

    .dotloader-inner {
      position: relative;
      display: block;
      width: 100%;
      height: 10px;
      margin-top: 38px;
    }

    .circle {
      display: inline-block;
      position: relative;
      /* key up the animations! */
      -webkit-animation: dotloader 2.5s infinite;
      -moz-animation: dotloader 2.5s infinite;
      -ms-animation: dotloader 2.5s infinite;
      -o-animation: dotloader 2.5s infinite;
      animation: dotloader 2.5s infinite;
    }

    .circle + .circle {
      margin-left: -25px;
      /* staggered effect cause by delay property */
      -webkit-animation: dotloader 2.5s 0.2s infinite;
      -moz-animation: dotloader 2.5s 0.2s infinite;
      -ms-animation: dotloader 2.5s 0.2s infinite;
      -o-animation: dotloader 2.5s 0.2s infinite;
      animation: dotloader 2.5s 0.2s infinite;
    }

    .circle + .circle + .circle {
      margin-left: -25px;
      -webkit-animation: dotloader 2.5s 0.4s infinite;
      -moz-animation: dotloader 2.5s 0.4s infinite;
      -ms-animation: dotloader 2.5s 0.4s infinite;
      -o-animation: dotloader 2.5s 0.4s infinite;
      animation: dotloader 2.5s 0.4s infinite;
    }

    .circle + .circle + .circle + .circle {
      margin-left: -25px;
      -webkit-animation: dotloader 2.5s 0.6s infinite;
      -moz-animation: dotloader 2.5s 0.6s infinite;
      -ms-animation: dotloader 2.5s 0.6s infinite;
      -o-animation: dotloader 2.5s 0.6s infinite;
      animation: dotloader 2.5s 0.6s infinite;
    }

    /* here be the animations matey! */
    @keyframes "dotloader" {
      0%,20% {
        width: 4px;
        height: 4px;
        -webkit-border-radius: 2px;
        -moz-border-radius: 2px;
        border-radius: 2px;
        left: 0%;
        background-color: rgba(0, 0, 0, 0);
      }
      30%,70% {
        width: 8px;
        height: 8px;
        -webkit-border-radius: 4px;
        -moz-border-radius: 4px;
        border-radius: 4px;
        left: 50%;
        background-color: rgba(0, 0, 0, 0.5);
      }
      80%,100% {
        width: 4px;
        height: 4px;
        -webkit-border-radius: 2px;
        -moz-border-radius: 2px;
        border-radius: 2px;
        left: 100%;
        background-color: rgba(0, 0, 0, 0);
      }
    }

    @-moz-keyframes dotloader {
      0%,20% {
        width: 4px;
        height: 4px;
        -moz-border-radius: 2px;
        border-radius: 2px;
        left: 0%;
        background-color: rgba(0, 0, 0, 0);
      }
      30%,70% {
        width: 8px;
        height: 8px;
        -moz-border-radius: 4px;
        border-radius: 4px;
        left: 50%;
        background-color: rgba(0, 0, 0, 0.5);
      }
      80%,100% {
        width: 4px;
        height: 4px;
        -moz-border-radius: 2px;
        border-radius: 2px;
        left: 100%;
        background-color: rgba(0, 0, 0, 0);
      }
    }

    @-webkit-keyframes "dotloader" {
      0%,20% {
        width: 4px;
        height: 4px;
        -webkit-border-radius: 2px;
        border-radius: 2px;
        left: 0%;
        background-color: rgba(0, 0, 0, 0);
      }
      30%,70% {
        width: 8px;
        height: 8px;
        -webkit-border-radius: 4px;
        border-radius: 4px;
        left: 50%;
        background-color: rgba(0, 0, 0, 0.5);
      }
      80%,100% {
        width: 4px;
        height: 4px;
        -webkit-border-radius: 2px;
        border-radius: 2px;
        left: 100%;
        background-color: rgba(0, 0, 0, 0);
      }
    }

    @-ms-keyframes "dotloader" {
      0%,20% {
        width: 4px;
        height: 4px;
        border-radius: 2px;
        left: 0%;
        background-color: rgba(0, 0, 0, 0);
      }
      30%,70% {
        width: 8px;
        height: 8px;
        border-radius: 4px;
        left: 50%;
        background-color: rgba(0, 0, 0, 0.5);
      }
      80%,100% {
        width: 4px;
        height: 4px;
        border-radius: 2px;
        left: 100%;
        background-color: rgba(0, 0, 0, 0);
      }
    }
    @-o-keyframes "dotloader" {
      0%,20% {
        width: 4px;
        height: 4px;
        border-radius: 2px;
        left: 0%;
        background-color: rgba(0, 0, 0, 0);
      }
      30%,70% {
        width: 8px;
        height: 8px;
        border-radius: 4px;
        left: 50%;
        background-color: rgba(0, 0, 0, 0.5);
      }
      80%,100% {
        width: 4px;
        height: 4px;
        border-radius: 2px;
        left: 100%;
        background-color: rgba(0, 0, 0, 0);
      }
    }
  </style>

  <div class="dotloader-container">
    <div class="dotloader-inner">
      <div class="circle">&nbsp;</div>
      <div class="circle">&nbsp;</div>
      <div class="circle">&nbsp;</div>
      <div class="circle">&nbsp;</div>
    </div>
  </div>
</template>

<template id="fn-loader-loader2-tpl">
  <style type="text/css">
    .spinner {
      width: 70px;
      text-align: center;
      display: table-cell;
      vertical-align: middle;
    }

    .spinner > div {
      width: 18px;
      height: 18px;
      background-color: #999;
      border-radius: 100%;
      display: inline-block;
      -webkit-animation: bouncedelay 1.4s infinite ease-in-out;
      animation: bouncedelay 1.4s infinite ease-in-out;
      -webkit-animation-fill-mode: both;
      animation-fill-mode: both;
    }

    .spinner .bounce1 {
      -webkit-animation-delay: -0.32s;
      animation-delay: -0.32s;
    }

    .spinner .bounce2 {
      -webkit-animation-delay: -0.16s;
      animation-delay: -0.16s;
    }

    @-webkit-keyframes bouncedelay {
      0%, 80%, 100% { -webkit-transform: scale(0.0) }
      40% { -webkit-transform: scale(1.0) }
    }

    @keyframes bouncedelay {
      0%, 80%, 100% { 
        transform: scale(0.0);
        -webkit-transform: scale(0.0);
      } 40% { 
        transform: scale(1.0);
        -webkit-transform: scale(1.0);
      }
    }
  </style>

  <div class="spinner">
    <div class="bounce1"></div>
    <div class="bounce2"></div>
    <div class="bounce3"></div>
  </div>
</template>

<template id="fn-loader-loader3-tpl">
  <style type="text/css">
    .spinner-outer {
      display: table-cell;
      vertical-align: middle;
    }

    .spinner {
      width: 50px;
      height: 30px;
      display: block;
      text-align: center;
      font-size: 10px;
      margin: auto;
    }

    .spinner > div {
      background-color: #999;
      height: 100%;
      width: 6px;
      display: inline-block;
      -webkit-animation: stretchdelay 1.2s infinite ease-in-out;
      animation: stretchdelay 1.2s infinite ease-in-out;
    }

    .spinner .rect2 {
      -webkit-animation-delay: -1.1s;
      animation-delay: -1.1s;
    }

    .spinner .rect3 {
      -webkit-animation-delay: -1.0s;
      animation-delay: -1.0s;
    }

    .spinner .rect4 {
      -webkit-animation-delay: -0.9s;
      animation-delay: -0.9s;
    }

    .spinner .rect5 {
      -webkit-animation-delay: -0.8s;
      animation-delay: -0.8s;
    }

    @-webkit-keyframes stretchdelay {
      0%, 40%, 100% { -webkit-transform: scaleY(0.4) }  
      20% { -webkit-transform: scaleY(1.0) }
    }

    @keyframes stretchdelay {
      0%, 40%, 100% { 
        transform: scaleY(0.4);
        -webkit-transform: scaleY(0.4);
      }  20% { 
        transform: scaleY(1.0);
        -webkit-transform: scaleY(1.0);
      }
    }
  </style>

  <div class="spinner-outer">
    <div class="spinner">
      <div class="rect1"></div>
      <div class="rect2"></div>
      <div class="rect3"></div>
      <div class="rect4"></div>
      <div class="rect5"></div>
    </div>
  </div>
</template>

<script type="text/javascript">
  var LoaderComponent = function() {

    this.createdCallback = function() {
      this.createShadowRoot();
      this.updateLoadingState();
      this.setAttribute("data-resolved", "data-resolved");

    };

    this.updateLoadingState = function() {
      this.shadowRoot.innerHTML = "";

      if (this.getAttribute("data-loading") == null) {
        this.shadowRoot.innerHTML = "<content />";
      } else {
        var tpl = Fnord.getTemplate("fn-loader", "base");
        var loader_type = this.getAttribute("data-loader-type") || "loader3";

        tpl.querySelector(".loader").appendChild(
            Fnord.getTemplate("fn-loader", loader_type));

        if (this.getAttribute("data-transparent") != null) {
          tpl.querySelector(".loader").setAttribute("data-transparent", "true");
        }

        this.shadowRoot.appendChild(tpl);
      }
    }

    this.attributeChangedCallback = function(attr, old_val, new_val) {
      if (attr == "data-loading") {
        this.updateLoadingState();
      }
    }
  };

  window.addEventListener("fn-ready", function() {
    Fnord.registerComponent("fn-loader", LoaderComponent);
  }, false);
</script>
