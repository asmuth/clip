<!--
  This file is part of the "FnordMetric" project
    Copyright (c) 2014 Laura Schlimmer
    Copyright (c) 2014 Paul Asmuth, Google Inc.

  FnordMetric is free software: you can redistribute it and/or modify it under
  the terms of the GNU General Public License v3.0. You should have received a
  copy of the GNU General Public License along with this program. If not, see
  <http://www.gnu.org/licenses/>.
-->
<template id="fn-checkbox-base-tpl">
  <input type="checkbox" />
</template>
<script type='text/javascript'>
  var CheckBoxComponent = function() {
    this.createdCallback = function() {



     /* if (this.hasAttribute('data-type')) {this.setInputType();}
      if (this.hasAttribute('data-state')) {this.setState();}
      if (this.hasAttribute('data-style')) {this.setStyle();}
      if (this.hasAttribute('data-preselected')) {this.setPreselection(); }*/

      this.attributeChangedCallback();

      this.addEventListener('click', function() {
        this.toggleActiveState();
      }, false);

    };

    this.attributeChangedCallback = function(attr, new_val, old_val) {
      switch (attr) {
        case 'data-type':
          this.setInputType();
          break;
        case 'data-state':
          this.setState();
          break;
        case 'data-preselected':
          this.setPreselection();
          break;
        default:
          break;
      }
    };

    this.toggleActiveState = function() {

      if (this.hasAttribute('data-active')) {
        this.removeAttribute('data-active');
        this.removeAttribute('data-preselected');

        var ev = new CustomEvent("fn-checkbox-unselect", {
            bubbles: true,
            cancelable: true
        });
        this.dispatchEvent(ev);

      } else {
        this.setAttribute('data-active', 'active');


        var ev = new CustomEvent("fn-checkbox-select", {
            bubbles: true,
            cancelable: true
        });
        this.dispatchEvent(ev);
      }
    }

    this.setInputType = function() {
      var type = this.getAttribute('data-type');
      if (type != null) {
        var input = this.shadowRoot.querySelector("input");
        var field = this.shadowRoot.querySelector(".field");
        input.type = type;
        field.setAttribute('data-type', type);
      }
    };

    this.setState = function() {
      var field = this.shadowRoot.querySelector(".field");
      field.setAttribute('data-state', this.getAttribute('data-state'));
    };

    this.setStyle = function() {
      var field = this.shadowRoot.querySelector(".field");
      field.className += " " + this.getAttribute('data-style');
    };

    this.setPreselection = function() {
      var field = this.shadowRoot.querySelector(".field");
      if (this.getAttribute('data-preselected')) {
        field.setAttribute('data-active', 'active');
      } else {
        field.removeAttribute('data-active');
      }
    }
  };

  window.addEventListener('fn-ready', function() {
    Fnord.registerComponent("fn-checkbox", CheckBoxComponent);
  }, false);
</script>
