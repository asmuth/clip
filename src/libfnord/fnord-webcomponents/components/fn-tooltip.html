<!--
  This file is part of the "FnordMetric" project
    Copyright (c) 2014 Laura Schlimmer
    Copyright (c) 2014 Paul Asmuth, Google Inc.

  FnordMetric is free software: you can redistribute it and/or modify it under
  the terms of the GNU General Public License v3.0. You should have received a
  copy of the GNU General Public License along with this program. If not, see
  <http://www.gnu.org/licenses/>.
-->
<template id="fn-tooltip-base-tpl">
</template>
<script type='text/javascript'>
  var TooltipComponent = function() {
    this.createdCallback = function() {
    };

    this.init = function(elem) {
      var base = this;
      elem.addEventListener('mouseover', function() {
          base.show(this);
      }, false);

      elem.addEventListener('mouseout', function() {
        base.hide();
      }, false);
    }

    this.initShowIf = function(elem, condition) {
      var base = this;
      elem.addEventListener('mouseover', function() {
        if (condition()) {
          base.show(this);
        }
      }, false);

      elem.addEventListener('mouseout', function() {
        base.hide();
      }, false);
    }


    this.show = function(elem) {
      this.setAttribute('data-active', 'active');

      this.style.left = this.getLeftValue(elem) + "px";
      this.style.top = this.getTopValue(elem) + "px";
    };

    this.getLeftValue = function(target) {
      var width = this.offsetWidth;
      var target_width = target.offsetWidth;
      var target_middle = Math.round(target_width / 2);
      var pos = target.getBoundingClientRect();
      var scroll_x = window.scrollX;
      var position = this.getAttribute('data-position');
      var pointer_pos = this.getAttribute('data-pointer');

      if (position == "right") {
        return pos.left + target_width + 7;
      }

      if (position == "left") {
        return pos.left - width - 7
      }

      if (pointer_pos == "right") {
        return (pos.left - width + target_middle + 15);
      }

      if (pointer_pos == "center") {
        return pos.left - ((width - target_width) / 2);
      }

      return (pos.left + target_middle - 15);
    }

    this.getTopValue = function(target) {
      var position = this.getAttribute('data-position');
      var pos = target.getBoundingClientRect();
      var relative = this.hasAttribute('data-relative');
      var scroll_x = window.scrollX;

      if (position == "bottom") {
        return pos.top + pos.height + scroll_x + 8;
      }

      if (position == "left" || position == "right") {
        return pos.top + scroll_x;
      }

      return (pos.top - this.offsetHeight + scroll_x - 8);
    };

    this.hide = function() {
      this.removeAttribute('data-active');
    }
  };

  window.addEventListener('fn-ready', function() {
    Fnord.registerComponent('fn-tooltip', TooltipComponent);
  }, false);
</script>
