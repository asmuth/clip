<!--
  This file is part of the "FnordMetric" project
    Copyright (c) 2014 Laura Schlimmer
    Copyright (c) 2014 Paul Asmuth, Google Inc.

  FnordMetric is free software: you can redistribute it and/or modify it under
  the terms of the GNU General Public License v3.0. You should have received a
  copy of the GNU General Public License along with this program. If not, see
  <http://www.gnu.org/licenses/>.
-->
<template id="fn-tooltip-base-tpl">
</template>
<script type='text/javascript'>
  var TooltipComponent = function() {
    this.createdCallback = function() {
    };

    this.init = function(elem) {
      var base = this;
      elem.addEventListener('mouseover', function() {
        base.show(this);
      }, false);

      elem.addEventListener('mouseout', function() {
        base.hide();
      }, false);
    }

    this.initShowIf = function(elem, condition) {
      var base = this;
      elem.addEventListener('mouseover', function() {
        if (condition()) {
          base.show(this);
        }
      }, false);

      elem.addEventListener('mouseout', function() {
        base.hide();
      }, false);
    }

    this.show = function(elem) {
      this.setAttribute('data-active', 'active');
      var position = this.getAttribute('data-position');
      var pos = elem.getBoundingClientRect();
      var relative = this.hasAttribute('data-relative');
      var scroll_y = window.scrollY;
      var scroll_x = window.scrollX;

      var left = (window.innerWidth - pos.left > this.offsetWidth) ? pos.left : window.innerWidth - elem.offsetWidth - this.offsetWidth;

      switch (position) {
        case 'bottom':
          var t_top = pos.height + scroll_y + 13;
          if (!(relative)) {t_top += pos.top - 5;}
          this.style.top = t_top + "px";
          this.style.left = pos.left + "px";
          break;
        case 'left':
          this.style.top = pos.top + scroll_y + "px";
          this.style.left = (pos.left - pos.width - 8) + "px";
          break;
        case 'right':
          this.style.top = pos.top + scroll_y + "px";
          this.style.left = (pos.left + pos.width + 8) + "px";
          break;
        default:
          this.style.top = (pos.top - this.offsetHeight + scroll_y - 8) + "px";
          this.style.left = left + "px";
          break;
      }
    }

    this.hide = function() {
      this.removeAttribute('data-active');
    }
  };

  window.addEventListener('fn-ready', function() {
    Fnord.registerComponent('fn-tooltip', TooltipComponent);
  }, false);
</script>
